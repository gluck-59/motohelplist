if(window.openDatabase){dbsize=5*1024*1024;db=openDatabase("motokofr_motohelplist",1,"",dbsize);moment.locale(getCookie("language"));relativeTime=parseInt(localStorage.getItem("relativeTime"))}else{document.getElementById("filter").style.display="none";document.getElementById("no_internet").style.display="none";document.getElementById("no_websql").style.display="block"}function getChrome(){window.open("https://www.google.com/chrome","_blank")}function submitfilter(form){var user="";db.readTransaction(function(tx){var feature=[];var query="SELECT * FROM helplist where 1 ";$("input:checked").each(function(){feature.push(this.id)});feature=feature.join(",");if(feature.length>0)query=query+"in("+feature+")";var user="";tx.executeSql(query,[],function(tx,result){user='<div id="userslist" class="small-12"><div class="small-12"><p class="right sortmode"><span id="abc" class="hide" onclick="sortingDist()">Города по алфавиту</span><span id="dist" class="hide" onclick="sortingABC()">Города по расстоянию</span>&nbsp;&#9650;</p></div><br>';if(result.rows.length==0){ohSnap("Никого не найдено. Измени параметры фильтра.");$("#loader").addClass("hide");user="";return false}if(localStorage.getItem("lastLat")==null||localStorage.getItem("lastLng")==null){ohSnap("Подсчет расстояний невозможен. Разреши определение своей геопозиции в настройках телефона.")}else{var lastlat=parseFloat(localStorage.getItem("lastLat"));var lastlng=parseFloat(localStorage.getItem("lastLng"))}for(var i=0;i<result.rows.length;i++){if(lastlat&&lastlng){var distance=calc_distance(lastlat,lastlng,parseFloat(result.rows.item(i).lat),parseFloat(result.rows.item(i).lng));distance=distance-distance%1}user=user+('<div id="'+distance+'" class="user_info1 hluser"><div class="userline small-12 columns"><span class="username '+(result.rows.item(i).gender==1?"female":"male")+'">'+result.rows.item(i).name+'</span>&nbsp;<span><a href="tel:+'+result.rows.item(i).phone+'" class="secondary radius label">ПОЗВОНИТЬ</a></div><div class="grey_text"><div class="small-12 hlcity" id="'+result.rows.item(i).city_name+'">'+result.rows.item(i).city_name);if(distance)user=user+", "+distance+" km";if(relativeTime)since=moment.unix(result.rows.item(i).date_last_login).fromNow();else since=moment.unix(result.rows.item(i).date_last_login).calendar();user=user+('</div></div><p class="grey_text">Приехал '+since+'</p><div class="small-12 labels1">');if(result.rows.item(i).help_repair)user=user+'<label class="radius error label">Ремонт</label>';if(result.rows.item(i).help_garage)user=user+'<label class="radius warning label">Гараж</label>';if(result.rows.item(i).help_food)user=user+'<label class="radius warning label">Поесть</label>';if(result.rows.item(i).help_bed)user=user+'<label class="radius error label">Ночлег</label>';if(result.rows.item(i).help_beer)user=user+'<label class="radius success label">По пиву</label>';if(result.rows.item(i).help_strong)user=user+'<label class="radius success label">Покрепче</label>';if(result.rows.item(i).help_party)user=user+'<label class="radius label">Компания</label>';if(result.rows.item(i).help_excursion)user=user+'<label class="radius label">Экскурсия</label>';user=user+"</div><br>";if(result.rows.item(i).description)user=user+'<p class="small-12 grey_text">'+result.rows.item(i).description+"</p><br>";user=user+'<div class="small-12 columns"></div></div>'}user=user+"</div>";document.getElementById("results").innerHTML=user;sortingDist();document.getElementById("userslist").scrollIntoView()},null)})}function sortingABC(){$("#loader").removeClass("hide");$("#abc").removeClass("hide");$("#dist").addClass("hide");var $elements=$(".hluser");var $target=$("#userslist");$elements.sort(function(a,b){var an=$(a).find(".hlcity").prop("id"),bn=$(b).find(".hlcity").prop("id");if(an&&bn){return an.toUpperCase().localeCompare(bn.toUpperCase())}return 0});$elements.detach().appendTo($target);$("#loader").addClass("hide")}function sortingDist(){$("#loader").removeClass("hide");$("#dist").removeClass("hide");$("#abc").addClass("hide");var $elements=$(".hluser");var $target=$("#userslist");$elements.sort(function(a,b){var an=parseInt(a.id);var bn=parseInt(b.id);if(isNaN(an)||isNaN(bn))return 0;if(an>bn)return 1;if(an<bn)return-1;return 0});$elements.detach().appendTo($target);$("#loader").addClass("hide")}function calc_distance(lat1,lon1,lat2,lon2){var radLat1=lat1*(Math.PI/180);var radLon1=lon1*(Math.PI/180);var radLat2=lat2*(Math.PI/180);var radLon2=lon2*(Math.PI/180);var earthRadius=6372.795;var radLonDif=radLon2-radLon1;var atan2top=Math.sqrt(Math.pow(Math.cos(radLat2)*Math.sin(radLonDif),2)+Math.pow(Math.cos(radLat1)*Math.sin(radLat2)-Math.sin(radLat1)*Math.cos(radLat2)*Math.cos(radLonDif),2));var atan2bottom=Math.sin(radLat1)*Math.sin(radLat2)+Math.cos(radLat1)*Math.cos(radLat2)*Math.cos(radLonDif);var deltaAngle=Math.atan2(atan2top,atan2bottom);return earthRadius*deltaAngle}function offline(){document.getElementById("no_internet").style.display="none";document.getElementById("filter").style.display="block"}